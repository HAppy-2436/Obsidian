# 单调队列

## 定义
单调队列（Monotonic Queue）是在滑动窗口或在线序列处理中维护单调性的双端队列，常用于在 O(n) 时间内得到窗口最大值或最小值。通过在入队时弹出队尾“无用”元素，保证队首始终为当前窗口的候选最值。

## 核心内容
**1. 单调递减队列（用于窗口最大值）**
```cpp
// 返回每个长度为 k 的窗口的最大值
vector<int> maxSlidingWindow(vector<int>& nums, int k) {
    deque<int> dq; // 存下标，队内对应值单调递减
    vector<int> res;
    for (int i = 0; i < nums.size(); ++i) {
        // 弹出过期索引
        if (!dq.empty() && dq.front() <= i - k) dq.pop_front();
        // 弹出尾部小于当前值的元素，保持单调递减
        while (!dq.empty() && nums[dq.back()] < nums[i]) dq.pop_back();
        dq.push_back(i);
        if (i >= k - 1) res.push_back(nums[dq.front()]);
    }
    return res;
}
```

**2. 单调递增队列（用于窗口最小值）**
```cpp
vector<int> minSlidingWindow(vector<int>& nums, int k) {
    deque<int> dq; // 存下标，队内值单调递增
    vector<int> res;
    for (int i = 0; i < nums.size(); ++i) {
        if (!dq.empty() && dq.front() <= i - k) dq.pop_front();
        while (!dq.empty() && nums[dq.back()] > nums[i]) dq.pop_back();
        dq.push_back(i);
        if (i >= k - 1) res.push_back(nums[dq.front()]);
    }
    return res;
}
```

**3. 单调队列的高级应用：最短满足和的子数组（LeetCode 862）**
```cpp
int shortestSubarray(vector<int>& A, int K) {
    int n = A.size();
    vector<long long> prefix(n + 1, 0);
    for (int i = 0; i < n; ++i) prefix[i+1] = prefix[i] + A[i];

    deque<int> dq; // 存前缀索引，prefix 值单调递增
    int ans = INT_MAX;
    for (int i = 0; i <= n; ++i) {
        while (!dq.empty() && prefix[i] - prefix[dq.front()] >= K) {
            ans = min(ans, i - dq.front());
            dq.pop_front();
        }
        while (!dq.empty() && prefix[i] <= prefix[dq.back()]) dq.pop_back();
        dq.push_back(i);
    }
    return ans == INT_MAX ? -1 : ans;
}
```

**4. 性能与复杂度**
- 时间复杂度：O(n)，每个元素最多入队和出队一次。
- 空间复杂度：O(k)（滑窗大小）或O(n)（最坏）。

## 应用场景
- 滑动窗口最大/最小（金融指标、信号峰值检测）
- 窗口内在线统计（实时监控）
- 最短子数组/满足约束的区间搜索
- 阈值检测、流处理问题
- 与单调栈组合处理柱状图、接雨水等问题

## 注意事项
- 队列中存下标而非值，便于判断过期窗口边界。
- 处理重复值时注意是否使用严格不等号（< 或 <=），影响出站条件。
- 边界情况：空数组、k<=0 或 k>n 需特殊处理。
- 循环数组或变长窗口要调整索引策略。
- 单调队列适合在线滑窗场景，不适用于任意区间修改。

## 关联知识
与 [[单调栈]]、[[滑动窗口]]、[[双端队列]]、[[前缀和]] 相关。
