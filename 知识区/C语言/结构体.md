# 结构体

## 定义
结构体（struct）是将不同类型数据组合成一个自定义复合类型的方法。通过结构体可以创建复杂的数据模型，如学生信息、坐标点等。结构体成员在内存中连续存储（考虑对齐），通过`.`或`->`访问。结构体是[[链表]]、树等复杂数据结构的基础，也是面向对象思想在C中的体现。

## 核心内容
**定义与声明**：
```c
// 方式1：先定义类型，再声明变量
struct Student {
    char name[50];
    int age;
    float score;
};
struct Student stu1;

// 方式2：定义类型同时声明变量
struct Point {
    int x, y;
} p1, p2;

// 方式3：typedef简化
typedef struct {
    int x, y;
} Point;
Point p;  // 无需struct关键字
```

**初始化**：
```c
struct Student stu1 = {"张三", 20, 95.5};  // 顺序初始化
struct Student stu2 = {.age=21, .name="李四"};  // 指定初始化（C99）
```

**成员访问**：
```c
struct Student stu;
stu.age = 20;              // 结构体变量用.
struct Student *p = &stu;
p->age = 21;               // 指针用->（等价于(*p).age）
```

**结构体指针**：
```c
struct Student *p = malloc(sizeof(struct Student));
p->age = 20;
strcpy(p->name, "王五");
free(p);
```

**内存对齐**：
编译器会对结构体成员进行内存对齐以提高访问效率：
```c
struct Example {
    char c;   // 1字节
    // 填充3字节
    int i;    // 4字节
    char d;   // 1字节
    // 填充3字节
};  // 总共12字节（而非6字节）
```
对齐规则：
- 成员按其类型大小对齐
- 结构体总大小是最大成员大小的倍数
- 可用`#pragma pack(n)`控制对齐

**结构体数组**：
```c
struct Student class[50];  // 50个学生
class[0].age = 20;
```

**嵌套结构体**：
```c
struct Date {
    int year, month, day;
};
struct Student {
    char name[50];
    struct Date birthday;  // 嵌套
};
```

**位字段**（位域）：
```c
struct Flags {
    unsigned int flag1 : 1;  // 1位
    unsigned int flag2 : 1;
    unsigned int value : 6;  // 6位
};  // 共1字节
```

## 应用场景
[[链表]]节点定义；复杂数据建模（学生、员工信息）；协议数据包；配置参数；文件记录；图形坐标；系统编程。

## 注意事项
- 结构体不能包含自身，但可包含指向自身的指针（链表）
- 注意内存对齐，影响sizeof大小
- 传参优先用指针（避免大量拷贝）
- 初始化顺序要与定义一致

## 关联知识
与 [[指针]]、[[链表]]、[[动态内存分配]]、[[共用体]]、[[内存布局]] 相关。
