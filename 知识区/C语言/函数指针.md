# 函数指针

## 定义
函数指针是存储函数地址的[[指针]]变量，可以通过函数指针调用函数。语法为：`返回类型 (*指针名)(参数列表)`。函数指针实现了回调机制、动态函数调用、函数表等高级特性，是C语言实现面向对象、插件化、事件驱动的基础工具，广泛用于操作系统、嵌入式、框架设计。

## 核心内容
**声明与使用**：
```c
// 普通函数
int add(int a, int b) {
    return a + b;
}

// 函数指针声明
int (*fp)(int, int);  // fp是指向函数的指针
fp = add;             // 函数名就是地址
// 或 fp = &add;

// 调用
int result = fp(3, 5);      // 方式1
// 或 result = (*fp)(3, 5);  // 方式2
```

**typedef简化**：
```c
typedef int (*Operation)(int, int);
Operation op = add;
int result = op(3, 5);
```

**函数指针数组**：
```c
int add(int a, int b) { return a + b; }
int sub(int a, int b) { return a - b; }
int mul(int a, int b) { return a * b; }

// 函数指针数组（函数表）
int (*ops[3])(int, int) = {add, sub, mul};
int result = ops[0](5, 3);  // 调用add
```

**回调函数**：
```c
// 回调函数：将函数作为参数传递
void process(int arr[], int size, int (*callback)(int)) {
    for(int i = 0; i < size; i++) {
        arr[i] = callback(arr[i]);
    }
}

int square(int x) { return x * x; }
int arr[] = {1, 2, 3};
process(arr, 3, square);  // 传递square函数
```

**qsort示例**：
```c
int compare(const void *a, const void *b) {
    return *(int*)a - *(int*)b;
}
int arr[] = {3, 1, 4, 1, 5};
qsort(arr, 5, sizeof(int), compare);
```

**函数指针与void***：
```c
void* dispatch(int type) {
    switch(type) {
        case 1: return (void*)func1;
        case 2: return (void*)func2;
    }
}
```

**返回函数指针的函数**：
```c
int (*getOp(char op))(int, int) {
    if(op == '+') return add;
    if(op == '-') return sub;
    return NULL;
}
```

## 应用场景
回调机制（事件处理、qsort）；状态机（函数表驱动）；插件系统；命令分发；策略模式；虚函数表（C++底层）；线程回调。

## 注意事项
- 函数名就是函数地址
- 注意函数签名必须匹配
- 回调函数要注意生命周期
- typedef可简化复杂声明

## 关联知识
与 [[指针]]、[[函数传参]]、[[回调函数]]、[[qsort]]、[[动态链接]] 相关。
